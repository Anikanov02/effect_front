<template>
  <div id="documents" class="container-main">
    <div class="top">
      <h2>
        {{ this.$t('documentation.all') }}
      </h2>
      <div class="search">
        <input type="text" @keypress="InputSearch($event)" @keyup="InputSearch($event)" v-model="search">
        <button class="btn-search" @click.prevent="searchDoc()">
          <span class="ico-search"></span>
        </button>
      </div>
    </div>
    <div class="all-docs">
      <template v-if="!ifSearch">
        <template v-for="doc in docs">
          <a target="_blank" rel="noopener noreferrer" :href="siteUrl + doc.doc.data.attributes.url" class="btn-docs" :key="doc.id">
            <div class="ico-download">
              <svg width="43" height="43" viewBox="0 0 43 43" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M25.6384 29.3474L23.2913 31.6049V21.4999C23.2913 21.0247 23.1026 20.569 22.7666 20.233C22.4306 19.897 21.9749 19.7083 21.4997 19.7083C21.0245 19.7083 20.5688 19.897 20.2328 20.233C19.8968 20.569 19.708 21.0247 19.708 21.4999V31.5153L17.3968 29.1862C17.2297 29.0191 17.0314 28.8866 16.8131 28.7962C16.5949 28.7058 16.3609 28.6593 16.1247 28.6593C15.8884 28.6593 15.6545 28.7058 15.4362 28.7962C15.218 28.8866 15.0197 29.0191 14.8526 29.1862C14.6855 29.3532 14.553 29.5515 14.4626 29.7698C14.3722 29.9881 14.3257 30.222 14.3257 30.4583C14.3257 30.6945 14.3722 30.9284 14.4626 31.1467C14.553 31.365 14.6855 31.5633 14.8526 31.7303L20.2276 37.1053C20.395 37.2714 20.5936 37.4028 20.8118 37.4919C21.0301 37.5811 21.2639 37.6263 21.4997 37.6249C21.961 37.6231 22.4038 37.4434 22.7359 37.1233L28.1109 31.9274C28.301 31.7705 28.4567 31.5761 28.5683 31.3563C28.6798 31.1365 28.7448 30.8961 28.7592 30.65C28.7736 30.404 28.7371 30.1576 28.6519 29.9263C28.5667 29.695 28.4347 29.4838 28.2642 29.3058C28.0936 29.1279 27.8882 28.987 27.6607 28.8921C27.4333 28.7971 27.1887 28.7501 26.9422 28.754C26.6958 28.7579 26.4528 28.8127 26.2284 28.9148C26.0041 29.0169 25.8032 29.1641 25.6384 29.3474Z" fill="#BDBDBD"/>
                <path d="M31.6586 12.5416C30.9275 10.4293 29.5562 8.59747 27.7355 7.30092C25.9147 6.00437 23.7351 5.30762 21.4999 5.30762C19.2647 5.30762 17.085 6.00437 15.2643 7.30092C13.4435 8.59747 12.0722 10.4293 11.3411 12.5416C9.7314 12.7572 8.21058 13.4064 6.94133 14.4196C5.67208 15.4329 4.70217 16.7721 4.13534 18.2941C3.56851 19.8161 3.4261 21.4635 3.72333 23.0602C4.02056 24.6568 4.74626 26.1427 5.82279 27.3587C5.95283 27.5877 6.13177 27.7853 6.34687 27.9373C6.56197 28.0893 6.80794 28.192 7.06726 28.2381C7.32658 28.2842 7.59288 28.2726 7.8472 28.2041C8.10151 28.1355 8.33758 28.0117 8.5386 27.8415C8.73961 27.6713 8.90064 27.4589 9.01019 27.2194C9.11975 26.9799 9.17515 26.7191 9.17245 26.4558C9.16974 26.1924 9.10901 25.9328 8.99456 25.6956C8.88011 25.4584 8.71476 25.2493 8.51029 25.0833C7.81712 24.3083 7.3636 23.3489 7.20468 22.3214C7.04576 21.2939 7.18828 20.2423 7.61495 19.2942C8.04162 18.346 8.73413 17.542 9.60857 16.9794C10.483 16.4169 11.5018 16.1201 12.5415 16.1249H12.7207C13.1399 16.1334 13.5487 15.9946 13.8761 15.7327C14.2034 15.4708 14.4286 15.1024 14.5124 14.6916C14.8413 13.0715 15.7203 11.615 17.0003 10.5688C18.2803 9.52261 19.8826 8.95109 21.5357 8.95109C23.1888 8.95109 24.7912 9.52261 26.0711 10.5688C27.3511 11.615 28.2301 13.0715 28.559 14.6916C28.6428 15.1024 28.868 15.4708 29.1953 15.7327C29.5227 15.9946 29.9316 16.1334 30.3507 16.1249H30.4582C31.4979 16.1201 32.5167 16.4169 33.3912 16.9794C34.2656 17.542 34.9581 18.346 35.3848 19.2942C35.8115 20.2423 35.954 21.2939 35.7951 22.3214C35.6361 23.3489 35.1826 24.3083 34.4895 25.0833C34.3316 25.2603 34.2105 25.4668 34.1331 25.691C34.0557 25.9151 34.0236 26.1524 34.0386 26.389C34.0536 26.6257 34.1154 26.857 34.2205 27.0696C34.3256 27.2822 34.4718 27.4718 34.6507 27.6274C34.9773 27.9155 35.3977 28.0747 35.8332 28.0754C36.0876 28.075 36.339 28.0205 36.5707 27.9155C36.8024 27.8105 37.0091 27.6573 37.177 27.4662C38.2833 26.2522 39.0347 24.7575 39.3489 23.1453C39.663 21.5331 39.5279 19.8656 38.9583 18.3251C38.3887 16.7845 37.4065 15.4302 36.1191 14.4102C34.8317 13.3902 33.2886 12.7438 31.6586 12.5416Z" fill="#BDBDBD"/>
              </svg>
            </div>
            <div class="info">
              <p class="name">
                {{doc.doc.data.attributes.name.split('.')[0]}}
              </p>
              <p class="date">
                {{doc.date}}
              </p>
            </div>
          </a>
        </template>
      </template>
      <template v-else>
        <template v-for="doc in searchDocs">
          <a target="_blank" rel="noopener noreferrer" :href="siteUrl + doc.doc.data.attributes.url" class="btn-docs" :key="doc.id">
            <div class="ico-download">
              <svg width="43" height="43" viewBox="0 0 43 43" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M25.6384 29.3474L23.2913 31.6049V21.4999C23.2913 21.0247 23.1026 20.569 22.7666 20.233C22.4306 19.897 21.9749 19.7083 21.4997 19.7083C21.0245 19.7083 20.5688 19.897 20.2328 20.233C19.8968 20.569 19.708 21.0247 19.708 21.4999V31.5153L17.3968 29.1862C17.2297 29.0191 17.0314 28.8866 16.8131 28.7962C16.5949 28.7058 16.3609 28.6593 16.1247 28.6593C15.8884 28.6593 15.6545 28.7058 15.4362 28.7962C15.218 28.8866 15.0197 29.0191 14.8526 29.1862C14.6855 29.3532 14.553 29.5515 14.4626 29.7698C14.3722 29.9881 14.3257 30.222 14.3257 30.4583C14.3257 30.6945 14.3722 30.9284 14.4626 31.1467C14.553 31.365 14.6855 31.5633 14.8526 31.7303L20.2276 37.1053C20.395 37.2714 20.5936 37.4028 20.8118 37.4919C21.0301 37.5811 21.2639 37.6263 21.4997 37.6249C21.961 37.6231 22.4038 37.4434 22.7359 37.1233L28.1109 31.9274C28.301 31.7705 28.4567 31.5761 28.5683 31.3563C28.6798 31.1365 28.7448 30.8961 28.7592 30.65C28.7736 30.404 28.7371 30.1576 28.6519 29.9263C28.5667 29.695 28.4347 29.4838 28.2642 29.3058C28.0936 29.1279 27.8882 28.987 27.6607 28.8921C27.4333 28.7971 27.1887 28.7501 26.9422 28.754C26.6958 28.7579 26.4528 28.8127 26.2284 28.9148C26.0041 29.0169 25.8032 29.1641 25.6384 29.3474Z" fill="#BDBDBD"/>
                <path d="M31.6586 12.5416C30.9275 10.4293 29.5562 8.59747 27.7355 7.30092C25.9147 6.00437 23.7351 5.30762 21.4999 5.30762C19.2647 5.30762 17.085 6.00437 15.2643 7.30092C13.4435 8.59747 12.0722 10.4293 11.3411 12.5416C9.7314 12.7572 8.21058 13.4064 6.94133 14.4196C5.67208 15.4329 4.70217 16.7721 4.13534 18.2941C3.56851 19.8161 3.4261 21.4635 3.72333 23.0602C4.02056 24.6568 4.74626 26.1427 5.82279 27.3587C5.95283 27.5877 6.13177 27.7853 6.34687 27.9373C6.56197 28.0893 6.80794 28.192 7.06726 28.2381C7.32658 28.2842 7.59288 28.2726 7.8472 28.2041C8.10151 28.1355 8.33758 28.0117 8.5386 27.8415C8.73961 27.6713 8.90064 27.4589 9.01019 27.2194C9.11975 26.9799 9.17515 26.7191 9.17245 26.4558C9.16974 26.1924 9.10901 25.9328 8.99456 25.6956C8.88011 25.4584 8.71476 25.2493 8.51029 25.0833C7.81712 24.3083 7.3636 23.3489 7.20468 22.3214C7.04576 21.2939 7.18828 20.2423 7.61495 19.2942C8.04162 18.346 8.73413 17.542 9.60857 16.9794C10.483 16.4169 11.5018 16.1201 12.5415 16.1249H12.7207C13.1399 16.1334 13.5487 15.9946 13.8761 15.7327C14.2034 15.4708 14.4286 15.1024 14.5124 14.6916C14.8413 13.0715 15.7203 11.615 17.0003 10.5688C18.2803 9.52261 19.8826 8.95109 21.5357 8.95109C23.1888 8.95109 24.7912 9.52261 26.0711 10.5688C27.3511 11.615 28.2301 13.0715 28.559 14.6916C28.6428 15.1024 28.868 15.4708 29.1953 15.7327C29.5227 15.9946 29.9316 16.1334 30.3507 16.1249H30.4582C31.4979 16.1201 32.5167 16.4169 33.3912 16.9794C34.2656 17.542 34.9581 18.346 35.3848 19.2942C35.8115 20.2423 35.954 21.2939 35.7951 22.3214C35.6361 23.3489 35.1826 24.3083 34.4895 25.0833C34.3316 25.2603 34.2105 25.4668 34.1331 25.691C34.0557 25.9151 34.0236 26.1524 34.0386 26.389C34.0536 26.6257 34.1154 26.857 34.2205 27.0696C34.3256 27.2822 34.4718 27.4718 34.6507 27.6274C34.9773 27.9155 35.3977 28.0747 35.8332 28.0754C36.0876 28.075 36.339 28.0205 36.5707 27.9155C36.8024 27.8105 37.0091 27.6573 37.177 27.4662C38.2833 26.2522 39.0347 24.7575 39.3489 23.1453C39.663 21.5331 39.5279 19.8656 38.9583 18.3251C38.3887 16.7845 37.4065 15.4302 36.1191 14.4102C34.8317 13.3902 33.2886 12.7438 31.6586 12.5416Z" fill="#BDBDBD"/>
              </svg>
            </div>
            <div class="info">
              <p class="name">
                {{doc.doc.data.attributes.name.split('.')[0]}}
              </p>
              <p class="date">
                {{doc.date}}
              </p>
            </div>
          </a>
        </template>
      </template>
    </div>
  </div>
</template>

<script>
import {mapGetters} from 'vuex'

export default {
  data() {
    return {
      search: '',
      ifSearch: false,
      searchDocs: [],
      siteUrl: ''
    }
  },
  async fetch({store}) {
    await Promise.all([
      store.dispatch('default/fetch'),
      store.dispatch('documents/fetch')
    ])
  },
  computed: {
    ...mapGetters({
      docs: 'documents/docs',
      seo: 'documents/seo'
    })
  },
  head() {
    const i18nSeo = this.$nuxtI18nSeo()
    return {
      htmlAttrs: {
        site: 'Ефект дитини',
        created_by: 'hoba.digital',
        ...i18nSeo.htmlAttrs
      },
      meta: [
        {
          hid: 'description',
          name: 'description',
          property: 'og:description',
          content: this.seo.desc
        },
        {
          hid: 'title',
          name: 'title',
          property: 'og:title',
          content: this.seo.title
        },
        {
          hid: 'og:image',
          property: 'og:image',
          content: this.siteUrl + this.seo.img.data.attributes.url
        },
        ...i18nSeo.meta
      ],
      title: this.seo.title
    }
  },
  methods: {
    InputSearch(e) {
      if (e.code == 'Enter') {
        if (this.search !== '') {
          this.searchDoc()
        } else {
          }
      }
      if (this.search == '') {
        this.ifSearch = false
      }
    },
    searchDoc() {
      this.searchDocs = []
      if (this.search !== '') {
        this.docs.forEach(d => {
          if (JSON.stringify(d).toUpperCase().indexOf(this.search.toUpperCase()) !== -1) {
            this.searchDocs.push(d)
          }
        })
        this.ifSearch = true
      }
    }
  },
  mounted() {
    this.siteUrl = process.env.apiUrl
    this.$nextTick(() => {
      console.log(this.$refs)
    });
  }
}
</script>

<style lang="scss">
  #documents {
    margin-top: 65px;
    .top {
      display: flex;
      justify-content: space-between;
      margin-bottom: 60px;
      margin-right: 35px;
      h2 {
        font-size: var(--fz1);
        font-weight: 600;
        font-family: 'Montserrat Alternates', sans-serif;
      }
      .search {
        display: flex;
        input {
          margin-right: 50px;
          width: 640px;
          border: 1px solid #BDBDBD;
          border-radius: 6px;
          padding: 0px 15px;
        }
      }
    }
    .all-docs {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-column-gap: 120px;
      grid-row-gap: 60px;
      .btn-docs {
        display: flex;
        font-weight: 400;
        .info {
          margin-top: 9px;
          margin-left: 20px;
          p {
            font-family: 'Montserrat Alternates', sans-serif;
          }
          .date {
            font-weight: 400;
            font-size: var(--fz4);
          }
        }
        path {
          transition: .3s;
        }
        &:hover {
          path {
            fill: var(--black);
          }
        }
      }
      .btn-all {
        height: calc(50px - 22px);
        margin-top: 5px;
      }
    }
  }

  @media screen and (max-width: 1760px) {
    #documents {
      .top {
        .search {
          input {
            width: 320px;
          }
        }
      }
    }
  }

  @media screen and (max-width: 1100px) {
    #documents {
      margin-top: 20px;
      .top {
        align-items: center;
        margin-bottom: 20px;
        margin-right: 0;
        .search {
          width: calc(100% - 300px);
          input {
            width: calc(100% - 20px - 32px);
            margin-right: 20px;
          }
        }
      }
      .all-docs {
        grid-row-gap: 20px;
        grid-column-gap: 50px;
        .ico-download {
          svg {
            width: 22px;
            height: 20px;
          }
        }
        .btn-docs {
          .info {
            margin-top: 0;
          }
        }
      }
    }
  }

  @media screen and (max-width: 860px) {
    #documents {
      .all-docs {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  }
  
  @media screen and (max-width: 600px) {
    #documents {
      .top {
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
        .search {
          width: 100%;
          margin-top: 10px;
          input {
            width: calc(100% - 20px - 32px);
            margin-right: 20px;
          }
        }
      }
      .all-docs {
        grid-template-columns: 1fr;
      }
    }
  }
</style>